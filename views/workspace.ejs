<!DOCTYPE html>
<html>
  <head>
    <title>Registration</title>

    <!-- Latest compiled and minified CSS -->
    <script
  src="https://code.jquery.com/jquery-3.1.1.js"
  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src='../js/jscolor.js'></script>
<link rel='stylesheet' href='/css/style.css?v=1' />
<style>
textarea:focus{
  outline: none;
  box-shadow: none;
  background: transparent;
}
textarea{
  outline: none;
  box-shadow: none;
  background: transparent;
}
input[type="text"]:focus{
  outline: none;
  box-shadow: none;
  background: transparent;
}
input[type="text"]{
  border:none;
  outline: none;
  box-shadow: none;
  background: transparent;
}
.input-container {
    background: url(/img/spectrum.png) no-repeat;
    width:197px;
    height:28px;
}
.input-container input{
    height:28px;
    line-height:28px;/*results in nice text vertical alignment*/
    border:none;
    background:transparent;
    padding:0 10px;/*don't start input text directly from the edge*/
    width:148px;/*full width - grey on the side - 2*10px padding*/
}
</style>
<body onload="onload()" style='background-color: <%= color %>'>

  <div class="main">
    <div class="row">
      <div id="header" class='internal_header' style="margin-top: 0px; margin-left: 13px; position:fixed; width: 100%; z-index:1000;">
          <div class="col-md-4 col-lg-4 col-xs-4 col-sm-4 nav text-left"><a href="../home"><img src='/img/favicon.png' height="50px;" width='50px'/></a></div>
            <div class="col-md-4  col-lg-4 col-xs-4 col-sm-4 nav text-center"><a href="#"><img src='/img/composition.png' height="50px;" width='50px'/></a></div>
              <div class="col-md-4  col-lg-4 col-xs-4 col-sm-4 nav text-right"><a href="#" id="search_icon"><img src='/img/search.png' height="50px;" width='50px'/></a><input style="display: none"  class='form-control text-center' type="text" id="search_project" placeholder="Type Project Name and Press Enter"/></div>
                  </div>
      <div class="text-center" style="border : 1px solid rgba(220,222,224, 0.6); border-top: none; height: 500px; margin-top: 0px;" id="double_header">
        <img src='<%= header_image %>' height="500px" width="100%"/>


        <% if (header_image === "") { %>
            Double Click to upload your Header Image
        <% } %>

          <input type="hidden" id="email" value="<%= email %>"/>
          <input type="hidden" id="project_name" value="<%= project_name %>"/>
          <input type="hidden" id="project_id" value="<%= project_id %>"/>
          <input id="header_image" name="header_image" class="hidden" type="file">
      </div>

      <div class="text-center">
        <h3 style="margin-top: 20px; cursor:pointer;" onclick='show_options()'> Composition </h3>

        <div id='options' style='display:none;'><img src='/img/cross.png' id='#cross_icon' width='30px' height='35px' style=' margin-left: 15px; cursor:pointer;' onclick='hide_options()'/><img src='/img/photo_upload.png' id='photo_upload_icon' width='30px' height='35px' style=' margin-left: 15px; cursor:pointer;'/><img id='description_icon' onclick="show_description()" src='/img/description.png'  width='30px' height='35px' style=' margin-left: 15px; cursor:pointer;'/>
          <img src='/img/spectrum.png' id='spectrum_icon' width='50px' height='7px' style=' margin-left: 15px; cursor:pointer;' onclick='click_spectrum_icon()'/>
          <img src='/img/spectrum.png' id='spectrum_icon_final' width='50px' height='7px' style='display:none; margin-left: 15px; cursor:pointer;' onclick='show__spectrum()'/>
          <input type='text' id='color_input' style='display: none;' value = '<%= color %>' placeholder="Enter Color Code!"/>
          <input src='/img/spectrum.png' style='display:none;' width='50px' height='7px' style=' margin-left: 15px; cursor:pointer;' value='<%= color %>' name="favcolor" id='color' class="jscolor {width:50, padding:0, shadow:false,
              borderWidth:0, backgroundColor:'transparent'}"/></div>
              <% if (description === "") { %>
                  <textarea class="text-center col-md-12 col-xs-12 col-lg-12 col-sm-12" id="project_description" placeholder="Add description of your Project Here!" maxlength="150" style="border: none; display:none; margin-top:50px;"></textarea>
              <% }else{ %>
        <textarea class="text-center col-md-12 col-xs-12 col-lg-12 col-sm-12" id="project_description" placeholder="Add description of your Project Here!" maxlength="150" style="border: none;  margin-top:50px;"><%= description %></textarea>
<%} %>
      </div></br></br>

        <input type="file" id="project_image" class="hidden"/>



    </div></br></br>
<div id="double_composition" style="height: 500px"><div class="row col-md-offset-1 col-md-10" id="project_images"></div></div>
  </div>
  <div class="modal fade" id="share_delete_modal" onclick='notshow();'>

<div class="col-md-2 text-center"><a href='#'><img style='margin-top: 80px; margin-left: 30px;' src='/img/share.png' height='50px' width='50px'/></a></div>
<div class="col-md-8 text-center"></div>
<div class="col-md-2 text-center"><a href='#'><img style='margin-top: 80px; margin-left: 30px;' onclick = 'delete_image();' src='/img/delete.png' height='50px' width='50px'/></a></div>

  </div>
  <input id="mousedown_src" type='hidden'/>
  <script type="text/javascript">
//project_description
function notshow(){
  $(".modal-dialog").css("width", "0%");
}
function keepshowing(){
  $(".modal-dialog").css("width", "100%");
}
function show_options(){
  $("#options").css("display", "block");
  $("#photo_upload_icon").css("display", "inline-block");
  $("#description_icon").css("display", "inline-block");
  $("#spectrum_icon").css("display", "inline-block");
}
function show_description(){
  $("#project_description").toggle();
}
function hide_options(){
 $("#options").css("display", "none");
 $("#spectrum_icon_final").css("display", "none");
 $("#color").css("display", "none");
}
function click_spectrum_icon(){
  $("#photo_upload_icon").css("display", "none");
  $("#description_icon").css("display", "none");
  $("#color_input").css("display", "inline-block");
  $("#spectrum_icon").css("display", "none");
  $("#spectrum_icon_final").css("display", "inline-block");

}
function show__spectrum(){

  $("#color_input").css("display", "none");
  $("#spectrum_icon_final").css("display", "none");
  $("#color").css("display", "inline-block");
}



function onload(){
  var email =  $("#email").val().trim();
  var project_id = $("#project_id").val().trim();

  $.post("/project_images", {
    postemail: email,
    project_id: project_id
  },function(data){
    data.sort();
    for(var i=0; i < data.length; i++){
       var image_name = data[i].replace(/^.*[\\\/]/, '').split(".")[0];
       $("#project_images").append("<div class='col-md-6 text-center' style='margin-top:50px;'><div><img class='mousedown' src='"+data[i]+"'  style='width:100%; height: 300px'></div><input id='image_name' type='text' old_name = '"+data[i]+"' value='"+image_name+"'/></div>");
    };

  })
}

$("#project_description").keyup(function(e){
  var project_name = $("#project_name").val().trim();
  var project_description = $("#project_description").val().trim();

    if(project_description != ""){
      $.post("/project_description",{
        postproject_description: project_description,
        postproject_name: project_name
      }, function(data){
        console.log(data);

      })
    }


});

  $("#double_header").dblclick(function(){
    $("#header_image").click();
  });


  $("#color").change(function(){

    var color =  "#"+$("#color").val().trim();


    $("body").css("background-color", color);
    var project_id = $("#project_id").val().trim();
    $.post("project_color",{
      project_id: project_id,
      color: color
    },function(data){
      console.log(data);
    });

  })

  $("#color_input").keyup(function(){

    var color =  $("#color_input").val().trim();


    if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(color)){

    $("body").css("background-color", color);
    var project_id = $("#project_id").val().trim();
    $.post("project_color",{
      project_id: project_id,
      color: color
    },function(data){
      console.log(data);
    });
}
  })

  $("#photo_upload_icon").click(function(){
    $("#project_image").click();
  })
$("#header_image, #project_image").change(function(){

  var header_image = $('#header_image').val();
  var project_image = $("#project_image").val();

  if(header_image === ""){
    var image = $("#project_image")[0].files[0];
    var type = "project_image";
    var ext = project_image.split('.').pop().toLowerCase();
  }else{
    var image = $("#header_image")[0].files[0];
    var type = "header_image";
    var ext = header_image.split('.').pop().toLowerCase();
  }



  var image_size = image.size;
  var project_name = $("#project_name").val().trim();
  var project_id = $("#project_id").val().trim();
  var formdata = new FormData();



if($.inArray(ext, ['png','jpg','jpeg']) == -1) {
    alert('Please make sure that your file is an image with an extension of png, jpg or jpeg');
}else if(image_size > 3242880){
alert("Please make sure that your image is less than 3 Mb!");
}else{
  formdata.append("image", image);
  formdata.append("project_name", project_name);
  formdata.append("type", type);
  formdata.append("ext", ext);
  formdata.append("project_id", project_id);
  $.ajax({
         url: 'upload_image',
         data: formdata,
         processData: false,
    contentType : false,
         type: 'POST',
         success: function ( data ) {
             window.location.reload();
         }
     });

}
})
var timer = null;
$(document).mousemove(function(){

  $("#header").fadeIn("slow");

  if (timer) {
       clearTimeout(timer);
       timer = 0;
   }

   timer = setTimeout(function() {
       $('#header').fadeOut("slow")
   }, 2000)
});
var timeoutId = 0;
$(document).on("mousedown", ".mousedown", function(e){
  var src = $(this).attr("src").trim();
  $("#mousedown_src").val(src);
  timeoutId = setTimeout(function(){
    $('#share_delete_modal').modal('show');
  }, 1000);

});

$(document).mouseup(function(){
    clearInterval(timeoutId);
    return false;
});
function delete_image(){

  var src = $("#mousedown_src").val().trim();
  $.post("delete_image", {
    postsrc : src
  }, function(data){
     window.location.reload();
  });
}
var time_again = null;
$(document).on("keyup", "#image_name", function(){

  var new_image_name = $(this).val().trim();
  var old_name = $(this).attr("old_name");

  if (time_again) {
       clearTimeout(time_again);
       timeagain = 0;
   }



     if(new_image_name != ""){
       if(new_image_name.length > 15){
         alert("Character Lenght of the image can't be greater than 15!");
       }else{
         old_name = $(this).attr("old_name");
         var re = /(?:\.([^.]+))?$/;
         var ext = re.exec(old_name)[1];
         console.log(ext);
         var path = old_name.substring(0, old_name.lastIndexOf('/'));
         $(this).attr("old_name", path+"/"+new_image_name+"."+ext);
         $.post("change_image_name", {
           postnew_image_name: new_image_name,
           postold_name: old_name
         }, function(data){
           if(data === true){
           console.log(data);
         }else{
           console.log(data);
         }

         })
       }
     }








});
function rgbToHex(R, G, B) {
  return toHex(R) + toHex(G) + toHex(B);
}

function toHex(n) {
  n = parseInt(n, 10);
  if (isNaN(n))  return "00";
  n = Math.max(0, Math.min(n, 255));
  return "0123456789ABCDEF".charAt((n - n % 16) / 16)  + "0123456789ABCDEF".charAt(n % 16);
}
  </script>
</body>
</html>
